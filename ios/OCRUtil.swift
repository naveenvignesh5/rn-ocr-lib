import Foundation
import VisionKit
import Vision

public class OCRUtil {
    var recognizedText: String

    init() {
        recognizedText = ""
    }

    func recognizeTextHandler(request: VNRequest, error: Error?) {
        guard let observations =
                request.results as? [VNRecognizedTextObservation] else {
            return
        }
        let recognizedStrings = observations.compactMap { observation in
            // Return the string of the top VNRecognizedText instance.
            return observation.topCandidates(1).first?.string
        }
        
        // Process the recognized strings.
        recognizedText = recognizedStrings.joined(separator: " ");
        print(recognizedStrings);
    }

    func getText(image: UIImage!) {
        // Get the CGImage on which to perform requests.
        guard let cgImage = image?.cgImage else { return }

        // Create a new image-request handler.
        let requestHandler = VNImageRequestHandler(cgImage: cgImage)

        // Create a new request to recognize text.
        let request = VNRecognizeTextRequest(completionHandler: recognizeTextHandler)

        do {
            // Perform the text-recognition request.
            try requestHandler.perform([request])
        } catch {
            print("Unable to perform the requests: \(error).")
        }
    }
}
